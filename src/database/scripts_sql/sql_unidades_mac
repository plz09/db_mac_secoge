-- codigo para criar e popular tabela unidades_mac
-- Atualizar
CREATE TABLE IF NOT EXISTS Unidades_mac (
        CNES_PADRAO INTEGER,
        CODIGO_UNIDADE INTEGER,
        DISTRITO INTEGER,
        NOME TEXT,
        TIPO_SERVI TEXT
    );
    
  INSERT INTO Unidades_tratado (CNES_PADRAO, CODIGO_UNIDADE, DISTRITO, NOME, TIPO_SERVI)
  SELECT CNES_PADRAO, CODIGO_UNIDADE, DISTRITO, NOME, TIPO_SERVI
  FROM Unidades;
  
 SELECT * 
 FROM Unidades_tratado
 WHERE CODIGO_UNIDADE = 0
 ;


 SELECT 
    fp.PA_PROC_ID,
    ut.TIPO_SERVI,
    SUM(fp.PA_QTDAPR)
FROM 
    fProducao2024 fp
JOIN 
    Unidades_tratado ut ON fp.PA_CODUNI = ut.CODIGO_UNIDADE
GROUP BY 
    fp.PA_PROC_ID, ut.TIPO_SERVI;



-- codigo para criar e popular tabela base_ouvidoria_mac

CREATE TABLE IF NOT EXISTS base_ouvidoria_mac (
        PROTOCOLO INTEGER,
        DATA_DA_DEMANDA DATE,
        DEMANDA_ATIVA TEXT,
        STATUS TEXT,
        DATA_DE_FECHAMENTO_DEMANDA DATE,
        DIAS_DE_TRAMITACAO INTEGER,
        PRAZO_VENCIDO TEXT,
        CLASSIFICACAO TEXT,
        ASSUNTO TEXT,
        SUBASSUNTO_01 TEXT,
        SUBASSUNTO_02 TEXT,
        SUBASSUNTO_03 TEXT,
        ESTAB_COMERCIAL TEXT,
        PRIMEIRO_DESTINO TEXT,
        DATA_PRIMEIRO_DESTINO_ENCAMINHAMENTO DATE,
        OUVIDORIA_SEGUNDO_ENCAMINHAMENTO TEXT,
        OUVIDORIA_TERCEIRO_ENCAMINHAMENTO TEXT,
        DESTINO_ATUAL TEXT,
        INDICADOR_RMAC TEXT    
    );



    INSERT INTO base_ouvidoria_mac (
        PROTOCOLO,
        DATA_DA_DEMANDA,
        DEMANDA_ATIVA,
        STATUS,
        DATA_DE_FECHAMENTO_DEMANDA,
        DIAS_DE_TRAMITACAO,
        PRAZO_VENCIDO,
        CLASSIFICACAO,
        ASSUNTO,
        SUBASSUNTO_01,
        SUBASSUNTO_02,
        SUBASSUNTO_03,
        ESTAB_COMERCIAL,
        PRIMEIRO_DESTINO,
        DATA_PRIMEIRO_DESTINO_ENCAMINHAMENTO,
        OUVIDORIA_SEGUNDO_ENCAMINHAMENTO,
        OUVIDORIA_TERCEIRO_ENCAMINHAMENTO,
        DESTINO_ATUAL,
        INDICADOR_RMAC)
    SELECT 
        PROTOCOLO,
        DATA_DA_DEMANDA,
        DEMANDA_ATIVA,
        STATUS,
        DATA_DE_FECHAMENTO_DA_DEMANDA,
        DIAS_DE_TRAMITACAO,
        PRAZO_VENCIDO,
        CLASSIFICACAO,
        ASSUNTO,
        SUBASSUNTO_1,
        SUBASSUNTO_2,
        SUBASSUNTO_3,
        ESTAB_COMERCIAL,
        MUN_PRIMEIRO_DESTINO,
        DATA_PRIMEIRO_DESTINO_ENCAMINHAMENTO,
        OUVIDORIA_SEGUNDO_ENCAMINHAMENTO,
        OUVIDORIA_TERCEIRO_ENCAMINHAMENTO,
        DESTINO_ATUAL,
        Indicador_RMAC
    FROM 
        base_ouvidoria;



-- Script para criar schemas
CREATE SCHEMA IF NOT EXISTS unidades;
CREATE SCHEMA IF NOT EXISTS spa;
CREATE SCHEMA IF NOT EXISTS producao;
CREATE SCHEMA IF NOT EXISTS ouvidoria;
CREATE SCHEMA IF NOT EXISTS horus;
CREATE SCHEMA IF NOT EXISTS mae_coruja;
CREATE SCHEMA IF NOT EXISTS atende_gestante;
CREATE SCHEMA IF NOT EXISTS atbasica;


-- Script para criar deletar schemas
DROP SCHEMA IF EXISTS unidades CASCADE;
DROP SCHEMA IF EXISTS producao CASCADE;
DROP SCHEMA IF EXISTS ouvidoria CASCADE;
DROP SCHEMA IF EXISTS horus CASCADE;
DROP SCHEMA IF EXISTS mae_coruja CASCADE;
DROP SCHEMA IF EXISTS atende_gestante CASCADE;
DROP SCHEMA IF EXISTS atbasica CASCADE;
DROP SCHEMA IF EXISTS spa CASCADE;
